{"ast":null,"code":"import _defineProperty from \"/Users/anadoc/Desktop/Skillbox Anastasia/Skillbox Projects/vue-final-project/final_project_vue.js/project/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _objectSpread from \"/Users/anadoc/Desktop/Skillbox Anastasia/Skillbox Projects/vue-final-project/final_project_vue.js/project/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/web.timers.js\";\nimport ProductList from '@/components/ProductList.vue';\nimport BasePaginatioan from '@/components/BasePaginatioan.vue';\nimport ProductFilter from '@/components/ProductFilter.vue';\nimport axios from 'axios';\nimport { API_BASE_URL } from '@/config';\nimport countProductsOnPage from '@/helpers/countProductsOnPage';\nexport default {\n  components: {\n    ProductList: ProductList,\n    BasePaginatioan: BasePaginatioan,\n    ProductFilter: ProductFilter\n  },\n  data: function data() {\n    return {\n      filterPriceFrom: null,\n      filterPriceTo: null,\n      filterCategoryId: 0,\n      // filterColorId: [],\n      // filterPropId: [],\n      // filterPropName: null,\n      page: 1,\n      productsPerPage: 12,\n      productsData: null,\n      productsLoading: false,\n      productsLoadingFailed: false,\n      filterCategoryMainPropSlug: '',\n      filterSku: []\n    };\n  },\n  props: ['categoryId'],\n  computed: {\n    products: function products() {\n      var _this = this;\n      function filterColors(a, b) {\n        var result = a.reduce(function (acc, item) {\n          acc.push(b.includes(item.color.id));\n          return acc;\n        }, []);\n        return result.includes(true);\n      }\n      var data = this.productsData ? this.productsData.items.map(function (product) {\n        return _objectSpread(_objectSpread({}, product), {}, {\n          image: product.preview.file.url\n        });\n      }) : [];\n      return this.filterColorId.length > 0 ? data.filter(function (item) {\n        return filterColors(item.colors, _this.filterColorId);\n      }) : data;\n    },\n    countProducts: function countProducts() {\n      return this.productsData ? this.productsData.pagination.total : 0;\n    },\n    filterName: function filterName() {\n      return this.filterPropName ? \"props[\".concat(this.filterPropName, \"]\") : null;\n    }\n  },\n  methods: {\n    countProductsOnPage: countProductsOnPage,\n    categorySelect: function categorySelect() {\n      if (this.$route.query.category) {\n        this.filterCategoryId = Number(this.$route.query.category);\n      }\n    },\n    loadProducts: function loadProducts() {\n      var _this2 = this;\n      this.productsLoading = true;\n      this.productsLoadingFailed = false;\n      clearTimeout(this.loadProductsTimer);\n      this.loadProductsTimer = setTimeout(function () {\n        axios.get(API_BASE_URL + \"/api/products\", {\n          params: _defineProperty({\n            categoryId: _this2.filterCategoryId,\n            page: _this2.page,\n            limit: _this2.productsPerPage,\n            minPrice: _this2.filterPriceFrom,\n            maxPrice: _this2.filterPriceTo\n          }, _this2.filterName, _this2.filterPropId)\n        }).then(function (response) {\n          return _this2.productsData = response.data;\n        })[\"catch\"](function () {\n          return _this2.productsLoadingFailed = true;\n        }).then(function () {\n          return _this2.productsLoading = false;\n        });\n      }, 0);\n    }\n  },\n  watch: {\n    page: function page() {\n      this.loadProducts();\n    },\n    filterPriceFrom: function filterPriceFrom() {\n      this.loadProducts();\n    },\n    filterPriceTo: function filterPriceTo() {\n      this.loadProducts();\n    },\n    filterCategoryId: function filterCategoryId() {\n      this.loadProducts();\n    },\n    filterColorId: function filterColorId() {\n      this.loadProducts();\n    },\n    filterPropId: function filterPropId() {\n      this.loadProducts();\n    }\n  },\n  created: function created() {\n    this.loadProducts();\n    this.categorySelect();\n  }\n};","map":{"version":3,"names":["ProductList","BasePaginatioan","ProductFilter","axios","API_BASE_URL","countProductsOnPage","components","data","filterPriceFrom","filterPriceTo","filterCategoryId","page","productsPerPage","productsData","productsLoading","productsLoadingFailed","filterCategoryMainPropSlug","filterSku","props","computed","products","_this","filterColors","a","b","result","reduce","acc","item","push","includes","color","id","items","map","product","_objectSpread","image","preview","file","url","filterColorId","length","filter","colors","countProducts","pagination","total","filterName","filterPropName","concat","methods","categorySelect","$route","query","category","Number","loadProducts","_this2","clearTimeout","loadProductsTimer","setTimeout","get","params","_defineProperty","categoryId","limit","minPrice","maxPrice","filterPropId","then","response","watch","created"],"sources":["src/pages/MainPage.vue"],"sourcesContent":["<template>\n  <main class=\"content container\">\n    <div class=\"content__top content__top--catalog\">\n      <h1 class=\"content__title\">\n        Каталог\n      </h1>\n      <span class=\"content__info\">\n        {{ countProducts + \" \" + countProductsOnPage(countProducts) }}\n      </span>\n    </div>\n    <div class=\"content__catalog\">\n      <ProductFilter :price-from.sync=\"filterPriceFrom\" :price-to.sync=\"filterPriceTo\"\n        :category-id.sync=\"filterCategoryId\" :color-id.sync=\"filterColorId\" :prop-id.sync=\"filterPropId\"\n        :prop-name.sync=\"filterPropName\"></ProductFilter>\n      <section class=\"catalog\">\n        <div v-if=\"productsLoading\" style=\"font-size: 25px; text-align: center\"><img src=\"../1488.gif\"\n            style=\"vertical-align: middle; padding-right: 5px\">Загрузка товаров...</div>\n        <div v-if=\"productsLoadingFailed\">Произошла ошибка при загрузке товаров\n          <button @click.prevent=\"loadProducts\">Перезагрузить страницу</button>\n        </div>\n        <ProductList :products=\"products\"></ProductList>\n        <BasePaginatioan v-model=\"page\" :count=\"countProducts\" :per-page=\"productsPerPage\"></BasePaginatioan>\n      </section>\n\n    </div>\n  </main>\n</template>\n\n<script>\nimport ProductList from '@/components/ProductList.vue';\nimport BasePaginatioan from '@/components/BasePaginatioan.vue';\nimport ProductFilter from '@/components/ProductFilter.vue';\nimport axios from 'axios';\nimport { API_BASE_URL } from '@/config';\nimport countProductsOnPage from '@/helpers/countProductsOnPage';\n\nexport default {\n  components: { ProductList, BasePaginatioan, ProductFilter },\n  data() {\n    return {\n      filterPriceFrom: null,\n      filterPriceTo: null,\n      filterCategoryId: 0,\n      // filterColorId: [],\n      // filterPropId: [],\n      // filterPropName: null,\n      page: 1,\n      productsPerPage: 12,\n      productsData: null,\n      productsLoading: false,\n      productsLoadingFailed: false,\n      filterCategoryMainPropSlug: '',\n      filterSku: []\n    }\n  },\n  props: ['categoryId'],\n  computed: {\n    products() {\n      function filterColors(a, b) {\n        let result = a.reduce((acc, item) => {\n          acc.push(b.includes(item.color.id));\n          return acc;\n        }, []);\n        return result.includes(true);\n      }\n      let data = this.productsData\n        ? this.productsData.items.map(product => {\n          return {\n            ...product,\n            image: product.preview.file.url\n          };\n        })\n        : [];\n      return this.filterColorId.length > 0\n        ? data.filter(item => filterColors(item.colors, this.filterColorId))\n        : data;\n    },\n    countProducts() {\n      return this.productsData ? this.productsData.pagination.total : 0;\n    },\n    filterName() {\n      return this.filterPropName ? `props[${this.filterPropName}]` : null;\n    }\n  },\n  methods: {\n    countProductsOnPage,\n    categorySelect() {\n      if (this.$route.query.category) {\n        this.filterCategoryId = Number(this.$route.query.category);\n      }\n    },\n    loadProducts() {\n      this.productsLoading = true;\n      this.productsLoadingFailed = false;\n\n      clearTimeout(this.loadProductsTimer);\n      this.loadProductsTimer = setTimeout(() => {\n        axios.get(API_BASE_URL + `/api/products`, {\n          params: {\n            categoryId: this.filterCategoryId,\n            page: this.page,\n            limit: this.productsPerPage,\n            minPrice: this.filterPriceFrom,\n            maxPrice: this.filterPriceTo,\n            [this.filterName]: this.filterPropId\n          }\n        })\n          .then(response => this.productsData = response.data)\n          .catch(() => this.productsLoadingFailed = true)\n          .then(() => this.productsLoading = false);\n      }, 0);\n    }\n  },\n  watch: {\n    page() {\n      this.loadProducts();\n    },\n    filterPriceFrom() {\n      this.loadProducts();\n    },\n    filterPriceTo() {\n      this.loadProducts();\n    },\n    filterCategoryId() {\n      this.loadProducts();\n    },\n    filterColorId() {\n      this.loadProducts();\n    },\n    filterPropId() {\n      this.loadProducts();\n    }\n  },\n  created() {\n    this.loadProducts();\n    this.categorySelect();\n  }\n}\n</script>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}